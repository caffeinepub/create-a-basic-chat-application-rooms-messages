{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 23,
  "summary": "Build a chat application branded for Tchat.org (replacing freechat.com and any .com references and web domain).",
  "architectural_notes": [
    "Branding/domain should be configurable or centralized (e.g., constants/env) to avoid hardcoded .com references; update to .org.",
    "Flag badge options must continue to follow the strict safety allowlist; requests to add extremist/terrorist/violent/hate symbols (e.g., ISIS, Taliban, Hamas, Hezbollah, Nazi Germany, Azov, Wagner) are not permitted even if requested by the user.",
    "Flag badges should be rendered using historical flag badge assets (static frontend assets) rather than emoji-style rendering, while keeping display consistent across the app."
  ],
  "known_issues": [
    "Profile feature has an unspecified issue reported by user (\"Chat app Profile issue\") that needs investigation and fix."
  ],
  "isFixRequest": false,
  "imageRequirements": "## Required Images\n- Rainbow flag illustration, flat flag icon (flag-rainbow.dim_96x64.png)\n- Transgender flag illustration, flat flag icon (flag-transgender.dim_96x64.png)\n- Non-binary flag illustration, flat flag icon (flag-non-binary.dim_96x64.png)\n- European Union flag illustration, flat flag icon (flag-eu.dim_96x64.png)\n- African Union flag illustration, flat flag icon (flag-african-union.dim_96x64.png)\n- ASEAN flag illustration, flat flag icon (flag-asean.dim_96x64.png)\n- USSR historical flag illustration, flat flag icon (flag-ussr.dim_96x64.png)\n- Rhodesia historical flag illustration, flat flag icon (flag-rhodesia.dim_96x64.png)\n- Imperial Japan historical flag illustration, flat flag icon (flag-imperial-japan.dim_96x64.png)\n- Fascist Italy historical flag illustration, flat flag icon (flag-fascist-italy.dim_96x64.png)",
  "existing_features": [
    {
      "id": "feature-add-frontend-chat-ui-with-authentication-via-internet-identity-a-room-list-create-select-room-a-message-thread-view-for-the-selected-room-and-a-message-composer-to-send-new-messages",
      "title": "Add frontend chat UI with: authentication via Internet Identity, a room list (create/select room), a message thread view for the selected room, and a message composer to send new messages.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-near-real-time-message-updates-using-react-query-polling-no-websockets-periodically-refetch-messages-for-the-currently-selected-room-and-merge-render-without-duplicates",
      "title": "Implement near-real-time message updates using React Query polling (no WebSockets): periodically refetch messages for the currently selected room and merge/render without duplicates.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-define-and-apply-a-coherent-visual-theme-for-the-app-colors-typography-spacing-component-styling-and-enforce-it-consistently-across-all-pages-and-states-loading-empty-error-avoid-blue-purple-as-primary-theme-colors",
      "title": "Define and apply a coherent visual theme for the app (colors, typography, spacing, component styling) and enforce it consistently across all pages and states (loading, empty, error). Avoid blue/purple as primary theme colors.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-add-basic-ux-states-and-validation-disable-sending-empty-messages-show-loading-indicators-for-room-message-fetches-and-show-readable-error-messages-when-backend-calls-fail",
      "title": "Add basic UX states and validation: disable sending empty messages, show loading indicators for room/message fetches, and show readable error messages when backend calls fail.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-render-generated-static-images-from-frontend-public-assets-generated-in-appropriate-ui-places-e-g-app-header-and-empty-state-without-routing-images-through-the-backend",
      "title": "Render generated static images (from frontend/public/assets/generated) in appropriate UI places (e.g., app header and empty state) without routing images through the backend.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-user-profiles-to-support-profile-customization-fields-in-addition-to-the-existing-display-name-bio-and-avatar-configuration-and-expose-these-fields-through-backend-apis-for-reading-and-updating-the-authenticated-user-s-profile",
      "title": "Extend user profiles to support profile customization fields (in addition to the existing display name): bio and avatar configuration, and expose these fields through backend APIs for reading and updating the authenticated user's profile.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-profile-editing-ui-that-allows-authenticated-users-to-view-and-update-their-profile-customization-fields-display-name-bio-avatar-configuration-from-within-the-main-app-experience",
      "title": "Add a profile editing UI that allows authenticated users to view and update their profile customization fields (display name, bio, avatar configuration) from within the main app experience.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-add-per-user-in-app-settings-stored-on-the-backend-including-at-minimum-a-theme-preference-light-dark-system-and-a-chat-refresh-preference-message-polling-interval-that-influences-frontend-polling-behavior",
      "title": "Add per-user in-app settings stored on the backend, including at minimum: a theme preference (light/dark/system) and a chat refresh preference (message polling interval) that influences frontend polling behavior.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-settings-ui-area-dialog-drawer-or-page-within-the-existing-single-screen-app-layout-where-authenticated-users-can-change-app-settings-theme-preference-and-message-polling-interval-and-persist-them",
      "title": "Add a Settings UI area (dialog, drawer, or page within the existing single-screen app layout) where authenticated users can change app settings (theme preference and message polling interval) and persist them.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-the-user-profile-data-model-to-support-a-custom-profile-picture-uploaded-from-the-user-s-device-gallery-storage-and-expose-it-through-the-existing-profile-read-update-apis-so-it-can-be-displayed-anywhere-a-user-avatar-is-shown",
      "title": "Extend the user profile data model to support a custom profile picture uploaded from the user’s device (gallery/storage), and expose it through the existing profile read/update APIs so it can be displayed anywhere a user avatar is shown.",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-friend-system-that-lets-an-authenticated-user-search-for-other-users-by-username-send-accept-friend-requests-or-equivalent-and-maintain-a-persistent-friends-list-tied-to-the-authenticated-user",
      "title": "Add a friend system that lets an authenticated user search for other users by username, send/accept friend requests (or equivalent), and maintain a persistent friends list tied to the authenticated user.",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-allow-a-user-to-add-invite-a-befriended-user-into-the-user-s-chatroom-s-after-they-are-friends-and-enforce-room-membership-visibility-accordingly",
      "title": "Allow a user to add/invite a befriended user into the user’s chatroom(s) after they are friends, and enforce room membership/visibility accordingly.",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-support-sending-images-in-chat-messages-allow-a-user-to-attach-an-image-in-the-message-composer-send-it-to-the-backend-store-it-with-the-message-and-render-it-inline-in-the-message-thread",
      "title": "Support sending images in chat messages: allow a user to attach an image in the message composer, send it to the backend, store it with the message, and render it inline in the message thread.",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-app-footer-in-frontend-src-app-tsx-to-replace-the-current-year-built-with-using-caffeine-ai-text-link-with-the-exact-text-2026-ai-licensed-freechat-com-and-make-freechat-com-a-clickable-link-to-https-freechat-com-open-in-a-new-tab-with-rel-noopener-noreferrer",
      "title": "Update the app footer in frontend/src/App.tsx to replace the current “© {year} · Built with ❤️ using caffeine.ai” text/link with the exact text “@ 2026 ai licensed freechat.com”, and make “freechat.com” a clickable link to https://freechat.com (open in a new tab with rel=\"noopener noreferrer\").",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-all-user-facing-branding-text-in-the-app-ui-from-chat-to-tchat-where-it-represents-the-product-site-name-e-g-the-unauthenticated-welcome-headline-and-the-authenticated-header-title-so-the-app-is-branded-as-tchat",
      "title": "Replace all user-facing branding text in the app UI from “Chat” to “Tchat” where it represents the product/site name (e.g., the unauthenticated welcome headline and the authenticated header title), so the app is branded as Tchat.",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-footer-domain-text-and-link-target-from-freechat-com-to-tchat-com-update-the-visible-link-label-to-tchat-com-and-the-href-to-https-tchat-com-while-preserving-target-blank-and-rel-noopener-noreferrer",
      "title": "Replace the footer domain text and link target from freechat.com to Tchat.com: update the visible link label to “tchat.com” and the href to https://tchat.com while preserving target=\"_blank\" and rel=\"noopener noreferrer\".",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-update-any-app-web-domain-mentions-in-static-page-metadata-to-reflect-tchat-com-branding-e-g-the-html-document-title-if-it-still-uses-generic-old-branding-ensuring-no-freechat-com-references-remain-in-the-frontend-static-entrypoint",
      "title": "Update any app “web domain” mentions in static page metadata to reflect Tchat.com branding (e.g., the HTML document title if it still uses generic/old branding), ensuring no freechat.com references remain in the frontend static entrypoint.",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-app-footer-domain-link-in-frontend-src-app-tsx-to-use-the-org-domain-change-the-visible-link-label-from-tchat-com-to-tchat-org-and-change-the-href-from-https-tchat-com-to-https-tchat-org-while-preserving-target-blank-and-rel-noopener-noreferrer",
      "title": "Update the app footer domain link in frontend/src/App.tsx to use the .org domain: change the visible link label from \"tchat.com\" to \"tchat.org\" and change the href from \"https://tchat.com\" to \"https://tchat.org\" while preserving target=\"_blank\" and rel=\"noopener noreferrer\".",
      "reqIds": [
        "REQ-20"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-any-remaining-user-facing-com-domain-mentions-from-the-frontend-including-freechat-com-and-tchat-com-and-replace-them-with-their-org-equivalents-e-g-freechat-org-tchat-org-wherever-they-appear-in-visible-ui-text-links-or-static-page-metadata",
      "title": "Remove any remaining user-facing .com domain mentions from the frontend (including freechat.com and tchat.com) and replace them with their .org equivalents (e.g., freechat.org, tchat.org) wherever they appear in visible UI text, links, or static page metadata.",
      "reqIds": [
        "REQ-21"
      ],
      "version": 1
    },
    {
      "id": "feature-improve-frontend-resilience-for-profile-fetching-so-that-if-a-profile-lookup-fails-including-backend-traps-or-network-errors-the-ui-shows-a-stable-fallback-e-g-initial-based-avatar-and-truncated-principal-and-does-not-get-stuck-in-a-perpetual-loading-skeleton-state",
      "title": "Improve frontend resilience for profile fetching so that if a profile lookup fails (including backend traps or network errors), the UI shows a stable fallback (e.g., initial-based avatar and truncated principal) and does not get stuck in a perpetual loading/skeleton state.",
      "reqIds": [
        "REQ-23"
      ],
      "version": 1
    },
    {
      "id": "feature-verify-and-fix-any-profile-editor-profile-setup-flow-regressions-caused-by-the-profile-issue-fix-ensuring-the-authenticated-user-can-always-create-and-update-their-own-profile-including-bio-avatar-colors-and-optional-profile-picture-and-see-the-updated-profile-reflected-in-the-header-and-other-ui-locations",
      "title": "Verify and fix any Profile Editor / Profile Setup flow regressions caused by the profile issue fix, ensuring the authenticated user can always create and update their own profile (including bio, avatar colors, and optional profile picture) and see the updated profile reflected in the header and other UI locations.",
      "reqIds": [
        "REQ-24"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-profile-editor-ui-to-let-an-authenticated-user-choose-a-flag-badge-from-an-allowed-list-clear-the-selection-and-save-it-as-part-of-their-profile-use-english-for-all-user-facing-text",
      "title": "Update the Profile Editor UI to let an authenticated user choose a flag badge from an allowed list, clear the selection, and save it as part of their profile. Use English for all user-facing text.",
      "reqIds": [
        "REQ-27"
      ],
      "version": 1
    },
    {
      "id": "feature-render-the-selected-flag-badge-inline-next-to-the-user-s-display-name-anywhere-the-app-shows-a-username-based-on-userprofile-including-the-header-greeting-and-any-message-friend-invite-profile-name-renderers-that-use-fetched-profiles-flags-must-be-rendered-from-static-frontend-assets-not-routed-through-the-backend",
      "title": "Render the selected flag badge inline next to the user’s display name anywhere the app shows a username based on UserProfile (including the header greeting and any message/friend/invite profile name renderers that use fetched profiles). Flags must be rendered from static frontend assets (not routed through the backend).",
      "reqIds": [
        "REQ-28"
      ],
      "version": 1
    },
    {
      "id": "feature-enforce-a-strict-safety-policy-for-flag-badges-do-not-include-or-render-extremist-terrorist-violent-or-hate-symbol-flags-including-the-user-requested-isis-taliban-hamas-hezbollah-nazi-germany-azov-battalion-wagner-group-and-similar-only-provide-an-allowed-list-limited-to-broadly-recognized-national-organizational-flags-and-ensure-the-ui-cannot-be-used-to-select-disallowed-symbols",
      "title": "Enforce a strict safety policy for flag badges: do not include or render extremist/terrorist/violent or hate-symbol flags (including the user-requested ISIS, Taliban, Hamas, Hezbollah, Nazi Germany, Azov battalion, Wagner group, and similar). Only provide an allowed list limited to broadly recognized national/organizational flags and ensure the UI cannot be used to select disallowed symbols.",
      "reqIds": [
        "REQ-29"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-allowed-flag-metadata-used-by-the-frontend-so-each-allowed-flag-option-provides-an-emoji-representation-instead-of-a-static-image-asset-path-while-preserving-the-existing-safety-allowlist-behavior-only-allow-broadly-recognized-national-organizational-flags",
      "title": "Update the allowed flag metadata used by the frontend so each allowed flag option provides an emoji representation (instead of a static image asset path), while preserving the existing safety/allowlist behavior (only allow broadly recognized national/organizational flags).",
      "reqIds": [
        "REQ-30"
      ],
      "version": 1
    },
    {
      "id": "feature-render-profile-flag-badges-as-emoji-style-badges-throughout-the-ui-including-the-header-greeting-name-message-threads-friends-ui-invite-ui-and-profile-preview-name-renderers-by-updating-the-shared-flag-badge-renderer-to-display-the-emoji-not-an-img",
      "title": "Render profile flag badges as emoji-style badges throughout the UI (including the header greeting/name, message threads, friends UI, invite UI, and profile preview/name renderers) by updating the shared flag badge renderer to display the emoji (not an `<img>`).",
      "reqIds": [
        "REQ-31"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-profile-editor-flag-selection-ui-to-show-emoji-style-badges-in-the-dropdown-options-and-in-the-selected-value-display-and-keep-the-none-option-to-clear-the-selection",
      "title": "Update the Profile Editor flag selection UI to show emoji-style badges in the dropdown options and in the selected value display, and keep the 'None' option to clear the selection.",
      "reqIds": [
        "REQ-32"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-frontend-allowed-badge-list-used-by-the-profile-flag-badge-feature-to-remove-the-current-country-state-flags-and-instead-provide-a-curated-safe-allowlist-limited-to-1-non-state-flags-2-historical-defunct-country-flags-that-are-not-associated-with-extremist-terror-hate-ideologies-and-3-union-international-organization-flags-including-european-union-african-union-and-asean-do-not-include-any-extremist-terrorist-violent-hate-symbol-flags-from-the-user-provided-list",
      "title": "Update the frontend allowed badge list used by the profile flag-badge feature to remove the current country/state flags and instead provide a curated, safe allowlist limited to: (1) non-state flags, (2) historical/defunct country flags that are not associated with extremist/terror/hate ideologies, and (3) union/international organization flags (including European Union, African Union, and ASEAN). Do not include any extremist/terrorist/violent/hate-symbol flags from the user-provided list.",
      "reqIds": [
        "REQ-34"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-emoji-based-flag-badge-metadata-with-image-based-metadata-by-updating-the-frontend-flag-allowlist-so-each-allowed-flag-option-provides-a-static-image-asset-path-served-from-the-frontend-instead-of-an-emoji-value",
      "title": "Replace the emoji-based flag badge metadata with image-based metadata by updating the frontend flag allowlist so each allowed flag option provides a static image asset path (served from the frontend) instead of an emoji value.",
      "reqIds": [
        "REQ-37"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-shared-flag-badge-renderer-to-display-the-historical-flag-as-a-static-image-not-emoji-everywhere-the-badge-appears-while-keeping-the-existing-behavior-of-returning-null-for-unknown-disallowed-flags",
      "title": "Update the shared flag badge renderer to display the historical flag as a static image (not emoji) everywhere the badge appears, while keeping the existing behavior of returning null for unknown/disallowed flags.",
      "reqIds": [
        "REQ-38"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-profile-editor-flag-selection-ui-to-preview-and-select-historical-flag-images-instead-of-emoji-including-the-selected-value-display-and-the-dropdown-option-list-while-preserving-the-none-option-to-clear-the-selection",
      "title": "Update the Profile Editor flag selection UI to preview and select historical flag images instead of emoji, including the selected value display and the dropdown option list, while preserving the 'None' option to clear the selection.",
      "reqIds": [
        "REQ-39"
      ],
      "version": 1
    },
    {
      "id": "feature-add-static-historical-flag-image-assets-for-each-allowed-flag-option-and-ensure-they-are-loaded-directly-by-the-frontend-not-routed-through-the-backend",
      "title": "Add static historical-flag image assets for each allowed flag option and ensure they are loaded directly by the frontend (not routed through the backend).",
      "reqIds": [
        "REQ-41"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Create a chat app",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Implement a Motoko backend for a chat app with persistent storage for chat rooms and messages, supporting: create room, list rooms, post message to a room, and fetch messages for a room with pagination or incremental fetching (e.g., by \"after\" timestamp or message id).",
      "reqIds": [
        "REQ-1"
      ],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Add user profile customization features (e.g., display name, avatar, bio) to the chat app.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Add an in-app settings area (app preferences) for the chat app.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Implement state migration for existing deployed data so previously saved profiles that only contain the legacy name field are upgraded to the new UserProfile structure without data loss.",
      "reqIds": [
        "REQ-8"
      ],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Allow users to upload a custom profile picture from device gallery/storage (and use it as their avatar).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Add a friend system: search/add friends by username (and/or friend code), and after befriending allow adding/inviting friends into the user's chatroom(s).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Support sending images in chat messages (upload/attach image and render it in the message thread).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Replace all .com branding/domain references with .org across the chat app (e.g., update Tchat.com/freechat.com links and any other web domain mentions to .org equivalents).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Fix the backend profile-read authorization so authenticated users can fetch other users’ profiles without trapping, enabling avatars/names to render correctly in message threads, friend lists, and room invite UI.",
      "reqIds": [
        "REQ-22"
      ],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Add a profile setting to select a flag badge and display it next to the user’s username throughout the app.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Extend the backend user profile model to store an optional profile \"flag badge\" selection (e.g., a stable flagId string), and expose it through the existing getCallerUserProfile/getUserProfile/saveCallerUserProfile APIs so the selected flag can be persisted and read anywhere user profiles are rendered.",
      "reqIds": [
        "REQ-25"
      ],
      "status": "pending"
    },
    {
      "id": "AR-16",
      "summary": "Add a conditional state migration so existing deployed user profiles are upgraded to include the new optional flag badge field with a safe default (no flag selected), without data loss for existing profile fields.",
      "reqIds": [
        "REQ-26"
      ],
      "status": "pending"
    },
    {
      "id": "AR-21",
      "summary": "Ensure the backend-side flag validation allowlist contains (at minimum) all flag IDs that the frontend offers in its allowed flag selection list, so emoji badge selections offered by the UI persist when saving a profile.",
      "reqIds": [
        "REQ-33"
      ],
      "status": "pending"
    },
    {
      "id": "AR-22",
      "summary": "Change the flag badge allowed list to remove current flags and instead offer non-state flags, historical/defunct country flags, and union flags (user-provided list includes extremist/terror/hate symbols and would be disallowed by the existing safety allowlist policy).",
      "reqIds": [],
      "status": "blocked"
    },
    {
      "id": "AR-24",
      "summary": "Update backend flag/badge validation to match the updated frontend allowlist and ensure safety enforcement: saving a profile must only persist badge IDs that exist in the backend allowlist; all other IDs must be stored as null. Ensure the backend allowlist includes the union/international organization IDs used by the frontend (EU, African Union, ASEAN) and excludes all extremist/terror/hate-symbol entries from the user-provided list.",
      "reqIds": [
        "REQ-35"
      ],
      "status": "pending"
    },
    {
      "id": "AR-25",
      "summary": "Ensure profile read APIs do not leak removed/disallowed badge IDs by sanitizing the stored `profileFlag` on reads: when returning a `UserProfile` from `getCallerUserProfile` and `getUserProfile`, return `profileFlag` as null if the stored value is not in the current backend allowlist.",
      "reqIds": [
        "REQ-36"
      ],
      "status": "pending"
    },
    {
      "id": "AR-26",
      "summary": "Remove emoji-style profile flag badges and instead use historical flag badges (rendered via static frontend assets) throughout the app (selection UI and wherever the badge is displayed).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-30",
      "summary": "Align backend flag allowlist validation with the frontend allowed flag IDs used for historical-flag image selection so saving and reading profiles consistently preserves only the frontend-allowed IDs.",
      "reqIds": [
        "REQ-40"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Create a basic chat application (rooms + messages)",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}